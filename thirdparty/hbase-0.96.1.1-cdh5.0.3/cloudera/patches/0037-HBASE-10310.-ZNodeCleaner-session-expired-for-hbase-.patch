From 8876bc6380c43991b635e1ae5192ade23a42d90a Mon Sep 17 00:00:00 2001
From: Andrew Kyle Purtell <apurtell@apache.org>
Date: Fri, 10 Jan 2014 22:47:39 +0000
Subject: [PATCH 37/73] HBASE-10310. ZNodeCleaner session expired for /hbase/master (Samir Ahmic)

Reason: Bug
Author: Samir Ahmic
Ref: CDH-17550

git-svn-id: https://svn.apache.org/repos/asf/hbase/branches/0.96@1557275 13f79535-47bb-0310-9956-ffa450edef68
---
 .../java/org/apache/hadoop/hbase/ZNodeClearer.java |   15 +++++++--------
 1 files changed, 7 insertions(+), 8 deletions(-)

diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/ZNodeClearer.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/ZNodeClearer.java
index 79929ef..ce32aab 100644
--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/ZNodeClearer.java
+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/ZNodeClearer.java
@@ -18,12 +18,6 @@
 
 package org.apache.hadoop.hbase;
 
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
-import org.apache.hadoop.conf.Configuration;
-import org.apache.hadoop.hbase.zookeeper.MasterAddressTracker;
-import org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher;
-
 import java.io.BufferedReader;
 import java.io.BufferedWriter;
 import java.io.File;
@@ -32,6 +26,12 @@ import java.io.FileReader;
 import java.io.FileWriter;
 import java.io.IOException;
 
+import org.apache.commons.logging.Log;
+import org.apache.commons.logging.LogFactory;
+import org.apache.hadoop.conf.Configuration;
+import org.apache.hadoop.hbase.zookeeper.MasterAddressTracker;
+import org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher;
+
 /**
  * <p>Contains a set of methods for the collaboration between the start/stop scripts and the
  * servers. It allows to delete immediately the znode when the master or the regions server crashes.
@@ -146,6 +146,7 @@ public class ZNodeClearer {
     String znodeFileContent;
     try {
       znodeFileContent = ZNodeClearer.readMyEphemeralNodeOnDisk();
+      return MasterAddressTracker.deleteIfEquals(zkw, znodeFileContent);
     } catch (FileNotFoundException fnfe) {
       // If no file, just keep going -- return success.
       LOG.warn("Can't find the znode file; presume non-fatal", fnfe);
@@ -156,7 +157,5 @@ public class ZNodeClearer {
     } finally {
       zkw.close();
     }
-
-    return MasterAddressTracker.deleteIfEquals(zkw, znodeFileContent);
   }
 }
-- 
1.7.0.4

