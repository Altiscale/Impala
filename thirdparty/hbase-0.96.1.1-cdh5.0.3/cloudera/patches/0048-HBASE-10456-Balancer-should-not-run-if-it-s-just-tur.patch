From bf0349af9821f972c6e4565264c9c062445af903 Mon Sep 17 00:00:00 2001
From: Himanshu <himanshu@cloudera.com>
Date: Tue, 4 Mar 2014 15:56:07 -0700
Subject: [PATCH 48/73] HBASE-10456 Balancer should not run if it's just turned off.

Author: Jimmy Xiang
Reason: Test fix
Ref: CDH-17835
---
 .../org/apache/hadoop/hbase/master/HMaster.java    |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java
index eca0b1b..9be1041 100644
--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java
+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java
@@ -1432,12 +1432,12 @@ MasterServices, Server {
       LOG.debug("Master has not been initialized, don't run balancer.");
       return false;
     }
-    // If balance not true, don't run balancer.
-    if (!this.loadBalancerTracker.isBalancerOn()) return false;
     // Do this call outside of synchronized block.
     int maximumBalanceTime = getBalancerCutoffTime();
     boolean balancerRan;
     synchronized (this.balancer) {
+      // If balance not true, don't run balancer.
+      if (!this.loadBalancerTracker.isBalancerOn()) return false;
       // Only allow one balance run at at time.
       if (this.assignmentManager.getRegionStates().isRegionsInTransition()) {
         Map<String, RegionState> regionsInTransition =
-- 
1.7.0.4

