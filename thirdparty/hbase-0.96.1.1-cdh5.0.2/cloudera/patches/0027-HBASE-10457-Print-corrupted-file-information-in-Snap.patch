From 84524a7fb4d887dd9b243c47c82239ae737bb767 Mon Sep 17 00:00:00 2001
From: Matteo Bertozzi <mbertozzi@apache.org>
Date: Tue, 4 Feb 2014 19:18:44 +0000
Subject: [PATCH 27/73] HBASE-10457 Print corrupted file information in SnapshotInfo tool without -file option (Bharath Vissapragada)

Reason: Usability
Author: Matteo Bertozzi
Ref: CDH-16074

git-svn-id: https://svn.apache.org/repos/asf/hbase/trunk@1564425 13f79535-47bb-0310-9956-ffa450edef68
---
 .../apache/hadoop/hbase/snapshot/SnapshotInfo.java |   25 +++++++++++--------
 1 files changed, 14 insertions(+), 11 deletions(-)

diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/snapshot/SnapshotInfo.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/snapshot/SnapshotInfo.java
index 686d960..08a444b 100644
--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/snapshot/SnapshotInfo.java
+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/snapshot/SnapshotInfo.java
@@ -264,6 +264,7 @@ public final class SnapshotInfo extends Configured implements Tool {
           snapshotName = args[++i];
         } else if (cmd.equals("-files")) {
           showFiles = true;
+          showStats = true;
         } else if (cmd.equals("-stats")) {
           showStats = true;
         } else if (cmd.equals("-schema")) {
@@ -297,7 +298,7 @@ public final class SnapshotInfo extends Configured implements Tool {
 
     printInfo();
     if (showSchema) printSchema();
-    if (showFiles || showStats) printFiles(showFiles);
+    printFiles(showFiles, showStats);
 
     return 0;
   }
@@ -348,7 +349,7 @@ public final class SnapshotInfo extends Configured implements Tool {
    * Collect the hfiles and logs statistics of the snapshot and
    * dump the file list if requested and the collected information.
    */
-  private void printFiles(final boolean showFiles) throws IOException {
+  private void printFiles(final boolean showFiles, final boolean showStats) throws IOException {
     if (showFiles) {
       System.out.println("Snapshot Files");
       System.out.println("----------------------------------------");
@@ -403,15 +404,17 @@ public final class SnapshotInfo extends Configured implements Tool {
       System.out.println("**************************************************************");
     }
 
-    System.out.printf("%d HFiles (%d in archive), total size %s (%.2f%% %s shared with the source table)%n",
-      stats.getStoreFilesCount(), stats.getArchivedStoreFilesCount(),
-      StringUtils.humanReadableInt(stats.getStoreFilesSize()),
-      stats.getSharedStoreFilePercentage(),
-      StringUtils.humanReadableInt(stats.getSharedStoreFilesSize())
-    );
-    System.out.printf("%d Logs, total size %s%n",
-      stats.getLogsCount(), StringUtils.humanReadableInt(stats.getLogsSize()));
-    System.out.println();
+    if (showStats) {
+      System.out.printf("%d HFiles (%d in archive), total size %s (%.2f%% %s shared with the source table)%n",
+        stats.getStoreFilesCount(), stats.getArchivedStoreFilesCount(),
+        StringUtils.humanReadableInt(stats.getStoreFilesSize()),
+        stats.getSharedStoreFilePercentage(),
+        StringUtils.humanReadableInt(stats.getSharedStoreFilesSize())
+      );
+      System.out.printf("%d Logs, total size %s%n",
+        stats.getLogsCount(), StringUtils.humanReadableInt(stats.getLogsSize()));
+      System.out.println();
+    }
   }
 
   private void printUsageAndExit() {
-- 
1.7.0.4

